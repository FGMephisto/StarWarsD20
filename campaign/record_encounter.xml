<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>
	<windowclass name="battle_header" merge="join">
		<script>
			function onInit()
				super.onInit();
				
				if DataCommon.isPFRPG() then
					if cr.getValue() == 0 and exp.getValue() == 0 then
						if DB.getChildCount(getDatabaseNode(), "npclist") &gt; 0 then
							button_refreshcr.onButtonPress();
						end
					end
				end
			end
			
			function update()
				super.update();

				local bReadOnly = WindowManager.getReadOnlyState(getDatabaseNode());
				cr.setReadOnly(bReadOnly);
				exp.setReadOnly(bReadOnly);
				
				local bPFMode = DataCommon.isPFRPG();
				button_refreshcr.setVisible(bPFMode and not bReadOnly);
				button_refreshxp.setVisible(bPFMode and not bReadOnly);
			end
		</script>
		<sheetdata>
			<label_recordtype name="recordtype_label" merge="delete" />

			<frame_record name="detailframe">
				<anchored height="40">
					<top parent="name" anchor="bottom" offset="5" />
					<left />
					<right />
				</anchored>
			</frame_record>
			<label name="cr_label">
				<anchored to="detailframe" position="insidetopleft" offset="15,10" />
				<static textres="battle_label_cr" />
				<tooltip textres="battle_tooltip_cr" />
			</label>
			<basicnumber name="cr" source="level">
				<anchored to="cr_label" position="righthigh" offset="10,0" width="30" height="20" />
				<tabtarget next="exp" prev="name" />
				<description textres="battle_tooltip_cr" />
			</basicnumber>
			<button_enc_refreshcr name="button_refreshcr" />

			<basicnumber name="exp">
				<anchored to="detailframe" position="insidetopright" offset="40,10" width="70" height="20" />
				<tabtarget next="npcs" prev="cr" />
				<description textres="battle_tooltip_xp" />
			</basicnumber>
			<label name="exp_label">
				<anchored to="exp" position="lefthigh" offset="10,0" />
				<static textres="battle_label_xp" />
				<tooltip textres="battle_label_xp" />
			</label>
			<button_enc_refreshxp name="button_refreshxp" />
		</sheetdata>
	</windowclass>
</root>
